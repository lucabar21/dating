<!-- üî• LOADING STATE -->
<app-spinner *ngIf="loading" class="spinner"></app-spinner>

<!-- üî• ERROR STATE -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-icon">‚ö†Ô∏è</div>
  <h2 class="error-title">Errore nel caricamento</h2>
  <p class="error-message">{{ error }}</p>
  <button class="retry-btn" (click)="retryLoadProfile()">üîÑ Riprova</button>
</div>

<!-- üî• MAIN CONTENT (SOLO QUANDO CARICATO) -->
<div class="wrapper" *ngIf="!loading && !error">
  <div class="justify-content-center">
    <!-- Tabs Navigation -->
    <div class="tabs-wrapper">
      <ul class="tabs" role="tablist">
        <li
          [class.active]="selectedTab === 'account'"
          (click)="selectedTab = 'account'"
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g id="style=fill">
              <g id="profile">
                <path
                  id="vector (Stroke)"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M6.75 6.5C6.75 3.6005 9.1005 1.25 12 1.25C14.8995 1.25 17.25 3.6005 17.25 6.5C17.25 9.3995 14.8995 11.75 12 11.75C9.1005 11.75 6.75 9.3995 6.75 6.5Z"
                />
                <path
                  id="rec (Stroke)"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M4.25 18.5714C4.25 15.6325 6.63249 13.25 9.57143 13.25H14.4286C17.3675 13.25 19.75 15.6325 19.75 18.5714C19.75 20.8792 17.8792 22.75 15.5714 22.75H8.42857C6.12081 22.75 4.25 20.8792 4.25 18.5714Z"
                />
              </g>
            </g>
          </svg>
          <span class="tab-text"> Account</span>
        </li>
        <li
          [class.active]="selectedTab === 'matching'"
          (click)="selectedTab = 'matching'"
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9 2C6.38 2 4.25 4.13 4.25 6.75C4.25 9.32 6.26 11.4 8.88 11.49C8.96 11.48 9.04 11.48 9.1 11.49C9.12 11.49 9.13 11.49 9.15 11.49C9.16 11.49 9.16 11.49 9.17 11.49C11.73 11.4 13.74 9.32 13.75 6.75C13.75 4.13 11.62 2 9 2Z"
            />
            <path
              d="M14.0809 14.1489C11.2909 12.2889 6.74094 12.2889 3.93094 14.1489C2.66094 14.9989 1.96094 16.1489 1.96094 17.3789C1.96094 18.6089 2.66094 19.7489 3.92094 20.5889C5.32094 21.5289 7.16094 21.9989 9.00094 21.9989C10.8409 21.9989 12.6809 21.5289 14.0809 20.5889C15.3409 19.7389 16.0409 18.5989 16.0409 17.3589C16.0309 16.1289 15.3409 14.9889 14.0809 14.1489Z"
            />
            <path
              d="M19.9894 7.33815C20.1494 9.27815 18.7694 10.9781 16.8594 11.2081C16.8494 11.2081 16.8494 11.2081 16.8394 11.2081H16.8094C16.7494 11.2081 16.6894 11.2081 16.6394 11.2281C15.6694 11.2781 14.7794 10.9681 14.1094 10.3981C15.1394 9.47815 15.7294 8.09815 15.6094 6.59815C15.5394 5.78815 15.2594 5.04815 14.8394 4.41815C15.2194 4.22815 15.6594 4.10815 16.1094 4.06815C18.0694 3.89815 19.8194 5.35815 19.9894 7.33815Z"
            />
            <path
              d="M21.9883 16.5904C21.9083 17.5604 21.2883 18.4004 20.2483 18.9704C19.2483 19.5204 17.9883 19.7804 16.7383 19.7504C17.4583 19.1004 17.8783 18.2904 17.9583 17.4304C18.0583 16.1904 17.4683 15.0004 16.2883 14.0504C15.6183 13.5204 14.8383 13.1004 13.9883 12.7904C16.1983 12.1504 18.9783 12.5804 20.6883 13.9604C21.6083 14.7004 22.0783 15.6304 21.9883 16.5904Z"
            />
          </svg>
          <span class="tab-text"> Matching</span>
        </li>
        <li
          [class.active]="selectedTab === 'theme'"
          (click)="selectedTab = 'theme'"
        >
          <svg
            fill="#000000"
            height="800px"
            width="800px"
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 512 512"
            xml:space="preserve"
          >
            <g>
              <g>
                <g>
                  <path
                    d="M490.667,149.333h-21.333c-11.797,0-21.333,9.557-21.333,21.333S457.536,192,469.333,192h21.333     c11.797,0,21.333-9.557,21.333-21.333S502.464,149.333,490.667,149.333z"
                  />
                  <path
                    d="M64,170.667c0-11.776-9.536-21.333-21.333-21.333H21.333C9.536,149.333,0,158.891,0,170.667S9.536,192,21.333,192h21.333     C54.464,192,64,182.443,64,170.667z"
                  />
                  <path
                    d="M437.25,79.447c3.84,0,7.723-1.024,11.221-3.2l18.133-11.264c10.027-6.229,13.077-19.371,6.869-29.397     c-6.208-9.984-19.371-13.077-29.376-6.848l-18.112,11.243c-10.027,6.229-13.099,19.392-6.891,29.397     C423.149,75.885,430.125,79.447,437.25,79.447z"
                  />
                  <path
                    d="M63.52,265.094l-18.133,11.264c-10.005,6.208-13.077,19.371-6.869,29.376c4.053,6.507,11.029,10.069,18.155,10.069     c3.819,0,7.723-1.024,11.221-3.2l18.133-11.264c10.005-6.208,13.077-19.371,6.869-29.376     C86.688,261.958,73.525,258.865,63.52,265.094z"
                  />
                  <path
                    d="M467.729,274.093l-18.24-11.072c-10.069-6.123-23.189-2.88-29.312,7.189c-6.123,10.091-2.88,23.189,7.168,29.291     l18.261,11.072c3.456,2.112,7.275,3.093,11.029,3.093c7.211,0,14.251-3.648,18.283-10.261     C481.02,293.314,477.798,280.194,467.729,274.093z"
                  />
                  <path
                    d="M44.271,67.241l18.24,11.072c3.477,2.091,7.275,3.093,11.051,3.093c7.211,0,14.251-3.669,18.261-10.283     c6.123-10.091,2.88-23.189-7.168-29.291L66.394,30.761c-10.069-6.123-23.189-2.901-29.312,7.168     C30.98,48.019,34.202,61.139,44.271,67.241z"
                  />
                  <path
                    d="M256,0C161.899,0,85.333,76.565,85.333,170.667c0,60.8,33.088,117.333,85.333,147.627v23.04h170.667v-23.04     c52.245-30.293,85.333-86.827,85.333-147.627C426.667,76.565,350.101,0,256,0z M256,128c-23.531,0-42.667,19.136-42.667,42.667     c0,11.776-9.536,21.333-21.333,21.333s-21.333-9.557-21.333-21.333c0-47.061,38.272-85.333,85.333-85.333     c11.797,0,21.333,9.557,21.333,21.333S267.797,128,256,128z"
                  />
                  <path
                    d="M170.667,448c0,11.776,9.536,21.333,21.333,21.333v21.333c0,11.776,9.536,21.333,21.333,21.333h85.333     c11.797,0,21.333-9.557,21.333-21.333v-21.333c11.797,0,21.333-9.557,21.333-21.333v-64H170.667V448z"
                  />
                </g>
              </g>
            </g>
          </svg>
          <span class="tab-text"> Tema</span>
        </li>
        <li
          [class.active]="selectedTab === 'notifications'"
          (click)="selectedTab = 'notifications'"
        >
          <svg
            width="800px"
            height="800px"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M19.3399 14.49L18.3399 12.83C18.1299 12.46 17.9399 11.76 17.9399 11.35V8.82C17.9399 6.47 16.5599 4.44 14.5699 3.49C14.0499 2.57 13.0899 2 11.9899 2C10.8999 2 9.91994 2.59 9.39994 3.52C7.44994 4.49 6.09994 6.5 6.09994 8.82V11.35C6.09994 11.76 5.90994 12.46 5.69994 12.82L4.68994 14.49C4.28994 15.16 4.19994 15.9 4.44994 16.58C4.68994 17.25 5.25994 17.77 5.99994 18.02C7.93994 18.68 9.97994 19 12.0199 19C14.0599 19 16.0999 18.68 18.0399 18.03C18.7399 17.8 19.2799 17.27 19.5399 16.58C19.7999 15.89 19.7299 15.13 19.3399 14.49Z"
            />
            <path
              d="M14.8297 20.01C14.4097 21.17 13.2997 22 11.9997 22C11.2097 22 10.4297 21.68 9.87969 21.11C9.55969 20.81 9.31969 20.41 9.17969 20C9.30969 20.02 9.43969 20.03 9.57969 20.05C9.80969 20.08 10.0497 20.11 10.2897 20.13C10.8597 20.18 11.4397 20.21 12.0197 20.21C12.5897 20.21 13.1597 20.18 13.7197 20.13C13.9297 20.11 14.1397 20.1 14.3397 20.07C14.4997 20.05 14.6597 20.03 14.8297 20.01Z"
            />
          </svg>
          <span class="tab-text"> Notifiche</span>
        </li>
        <li
          [class.active]="selectedTab === 'actions'"
          (click)="selectedTab = 'actions'"
        >
          <svg
            width="800px"
            height="800px"
            viewBox="0 0 1024 1024"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256zm0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4z"
            /></svg
          ><span class="tab-text"> Azioni</span>
        </li>
      </ul>
    </div>

    <!-- üî• ACCOUNT TAB -->
    <div *ngIf="selectedTab === 'account'" class="ng-div">
      <!-- Account Info Section -->
      <div class="settings-card mb-4">
        <div class="section-header">
          <h3 class="mb-0">Informazioni Account</h3>
        </div>
        <div class="">
          <!-- üî• PROFILE IMAGE - CON DATI REALI -->
          <div class="profile-image-wrapper" (click)="triggerFileInput()">
            <img
              *ngIf="userProfile.profileImageUrl; else placeholder"
              [src]="userProfile.profileImageUrl"
              alt="Foto profilo"
              class="profile-image"
              (error)="onImageError($event)"
            />

            <ng-template #placeholder>
              <div class="profile-placeholder-text">
                Aggiungi / Modifica<br />Immagine Profilo
              </div>
            </ng-template>

            <div *ngIf="userProfile.profileImageUrl" class="edit-label">
              Modifica
            </div>

            <input
              type="file"
              #fileInput
              (change)="onFileSelected($event)"
              accept="image/*"
              hidden
            />
          </div>

          <!-- üî• NOME - CON DATI REALI -->
          <div class="editable-field" [class.editing]="editingFields.nome">
            <div class="field-info">
              <div class="field-label">Nome</div>
              <div class="field-value" *ngIf="!editingFields.nome">
                {{ userProfile.nome || 'Nome non inserito' }}
              </div>
              <input
                type="text"
                class="field-input"
                [(ngModel)]="userProfile.nome"
                *ngIf="editingFields.nome"
                placeholder="Inserisci il tuo nome"
                #nomeInput
              />
            </div>
            <div class="field-actions">
              <button
                class="edit-btn"
                *ngIf="!editingFields.nome"
                (click)="startEdit('nome')"
                [disabled]="saving"
              >
                Modifica <i class="fas fa-edit"></i>
              </button>
              <button
                class="save-btn"
                *ngIf="editingFields.nome"
                (click)="saveField('nome')"
                [disabled]="saving"
              >
                {{ saving ? 'Salvando...' : 'Salva' }}
              </button>
              <button
                class="cancel-btn"
                *ngIf="editingFields.nome"
                (click)="cancelEdit('nome')"
                [disabled]="saving"
              >
                Annulla
              </button>
            </div>
          </div>

          <!-- üî• EMAIL/USERNAME - SOLO VISUALIZZAZIONE -->
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Email/Username</div>
              <div class="field-value">{{ userProfile.username }}</div>
            </div>
            <div class="field-actions">
              <span class="info-text">Non modificabile</span>
            </div>
          </div>

          <!-- üî• GENERE - EDITABILE come Nome/Bio -->
          <div class="editable-field" [class.editing]="editingFields.genere">
            <div class="field-info">
              <div class="field-label">Genere</div>
              <div class="field-value" *ngIf="!editingFields.genere">
                {{ userProfile.genere || 'Non specificato' }}
              </div>
              <select
                class="field-input"
                *ngIf="editingFields.genere"
                [(ngModel)]="userProfile.genere"
                #genereInput
              >
                <option value="">Seleziona</option>
                <option value="MASCHIO">MASCHIO</option>
                <option value="FEMMINA">FEMMINA</option>
              </select>
            </div>
            <div class="field-actions">
              <button
                class="edit-btn"
                *ngIf="!editingFields.genere"
                (click)="startEdit('genere')"
                [disabled]="saving"
              >
                Modifica <i class="fas fa-edit"></i>
              </button>
              <button
                class="save-btn"
                *ngIf="editingFields.genere"
                (click)="saveField('genere')"
                [disabled]="saving"
              >
                {{ saving ? 'Salvando...' : 'Salva' }}
              </button>
              <button
                class="cancel-btn"
                *ngIf="editingFields.genere"
                (click)="cancelEdit('genere')"
                [disabled]="saving"
              >
                Annulla
              </button>
            </div>
          </div>

          <!-- üî• BIO - CON DATI REALI -->
          <div class="editable-field" [class.editing]="editingFields.bio">
            <div class="field-info">
              <div class="field-label">Bio</div>
              <div class="field-value" *ngIf="!editingFields.bio">
                {{ userProfile.bio || 'Raccontaci qualcosa di te...' }}
              </div>
              <textarea
                class="field-input"
                rows="3"
                [(ngModel)]="userProfile.bio"
                *ngIf="editingFields.bio"
                placeholder="Raccontaci qualcosa di te..."
                #bioInput
              ></textarea>
            </div>
            <div class="field-actions">
              <button
                class="edit-btn"
                *ngIf="!editingFields.bio"
                (click)="startEdit('bio')"
                [disabled]="saving"
              >
                Modifica <i class="fas fa-edit"></i>
              </button>
              <button
                class="save-btn"
                *ngIf="editingFields.bio"
                (click)="saveField('bio')"
                [disabled]="saving"
              >
                {{ saving ? 'Salvando...' : 'Salva' }}
              </button>
              <button
                class="cancel-btn"
                *ngIf="editingFields.bio"
                (click)="cancelEdit('bio')"
                [disabled]="saving"
              >
                Annulla
              </button>
            </div>
          </div>

          <!-- üî• INTERESSI - CON DATI REALI -->
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Interessi</div>
              <div class="field-value">I tuoi interessi e passioni</div>
              <div class="interests-display">
                <span
                  class="selected-interest"
                  *ngFor="let interest of getSelectedInterestsDisplay()"
                >
                  {{ interest }}
                </span>
                <span
                  *ngIf="selectedInterests.length === 0"
                  class="no-interests-text"
                >
                  Nessun interesse selezionato
                </span>
              </div>
            </div>
            <div class="field-actions">
              <button
                class="password-btn interests-btn"
                (click)="openInterestsModal()"
                [disabled]="saving"
              >
                <i class="fas fa-tags"></i> Modifica Interessi
              </button>
            </div>
          </div>

          <!-- üî• CITT√Ä - EDITABILE con AUTOCOMPLETAMENTO -->
          <div class="editable-field" [class.editing]="editingFields.citta">
            <div class="field-info">
              <div class="field-label">Citt√†</div>
              <div class="field-value" *ngIf="!editingFields.citta">
                {{ selectedCity?.name || userProfile.citta || 'Citt√† non
                specificata' }}
              </div>

              <!-- INPUT CON AUTOCOMPLETAMENTO quando in editing -->
              <div
                *ngIf="editingFields.citta"
                class="city-autocomplete-container"
              >
                <input
                  type="text"
                  class="field-input"
                  [(ngModel)]="cityQuery"
                  (input)="searchCities(cityQuery)"
                  (focus)="searchCities(cityQuery)"
                  (blur)="hideCitySuggestions()"
                  placeholder="Cerca citt√† italiana..."
                  [disabled]="saving"
                  #cittaInput
                />

                <!-- Dropdown suggerimenti -->
                <div class="city-suggestions" *ngIf="showCitySuggestions">
                  <div
                    *ngFor="let city of citySuggestions"
                    class="city-suggestion-item"
                    (click)="onCitySelect(city)"
                  >
                    <strong>{{ city.name }}</strong>
                    <small>{{ city.fullName }}</small>
                  </div>
                  <div
                    *ngIf="citySuggestions.length === 0"
                    class="no-suggestions"
                  >
                    Nessuna citt√† trovata
                  </div>
                </div>
              </div>
            </div>

            <div class="field-actions">
              <button
                class="edit-btn"
                *ngIf="!editingFields.citta"
                (click)="startEditCity()"
                [disabled]="saving"
              >
                Modifica <i class="fas fa-edit"></i>
              </button>
              <button
                class="save-btn"
                *ngIf="editingFields.citta"
                (click)="saveCityField()"
                [disabled]="saving || !selectedCity"
              >
                {{ saving ? 'Salvando...' : 'Salva' }}
              </button>
              <button
                class="cancel-btn"
                *ngIf="editingFields.citta"
                (click)="cancelEditCity()"
                [disabled]="saving"
              >
                Annulla
              </button>
            </div>
          </div>

          <!-- üî• DATA DI NASCITA EDITABILE -->
          <div
            class="editable-field"
            [class.editing]="editingFields.dataNascita"
          >
            <div class="field-info">
              <div class="field-label">Data di Nascita</div>
              <div class="field-value" *ngIf="!editingFields.dataNascita">
                {{ userProfile.dataNascita ? (userProfile.dataNascita |
                date:'dd/MM/yyyy') : 'Non specificata' }}
                <span *ngIf="userProfile.eta > 0" class="age-display"
                  >({{ userProfile.eta }} anni)</span
                >
              </div>
              <input
                type="date"
                class="field-input"
                [(ngModel)]="userProfile.dataNascita"
                *ngIf="editingFields.dataNascita"
                #dataNascitaInput
              />
            </div>
            <div class="field-actions">
              <button
                class="edit-btn"
                *ngIf="!editingFields.dataNascita"
                (click)="startEdit('dataNascita')"
                [disabled]="saving"
              >
                Modifica <i class="fas fa-edit"></i>
              </button>
              <button
                class="save-btn"
                *ngIf="editingFields.dataNascita"
                (click)="saveField('dataNascita')"
                [disabled]="saving"
              >
                {{ saving ? 'Salvando...' : 'Salva' }}
              </button>
              <button
                class="cancel-btn"
                *ngIf="editingFields.dataNascita"
                (click)="cancelEdit('dataNascita')"
                [disabled]="saving"
              >
                Annulla
              </button>
            </div>
          </div>

          <!-- Password Change -->
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Password</div>
              <div class="field-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            </div>
            <div class="field-actions">
              <button class="password-btn" (click)="openPasswordModal()">
                <i class="fas fa-key"></i> Cambia Password
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üî• MATCHING TAB -->
    <div *ngIf="selectedTab === 'matching'" class="ng-div">
      <!-- Preferenze Matching Section -->
      <div class="settings-card mb-4">
        <div class="section-header">
          <h3 class="mb-0">Preferenze di Matching</h3>
        </div>
        <div class="p-4">
          <!-- Genere Preferito -->
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Genere Preferito</div>
              <div class="field-value">Chi ti interessa incontrare</div>
            </div>
            <div class="field-actions">
              <div class="gender-badges">
                <span
                  class="gender-badge male"
                  [class.selected]="preferences.generePreferito === 'MASCHIO'"
                  (click)="selectGender('MASCHIO')"
                >
                  üë® Uomini
                </span>
                <span
                  class="gender-badge female"
                  [class.selected]="preferences.generePreferito === 'FEMMINA'"
                  (click)="selectGender('FEMMINA')"
                >
                  üë© Donne
                </span>
              </div>
            </div>
          </div>

          <!-- Fascia d'Et√† -->
          <div class="editable-field w-100">
            <div class="field-info">
              <div class="field-label">Fascia d'Et√†</div>
              <div class="field-value">Et√† minima e massima dei tuoi match</div>
            </div>
            <div class="field-actions w-100">
              <div
                class="range-container d-flex justify-content-center gap-3 w-100"
              >
                <div class="sm-col-auto">
                  <label class="form-label small">Et√† Minima</label>
                  <div class="range-container">
                    <input
                      type="range"
                      class="range-slider"
                      min="18"
                      max="65"
                      [(ngModel)]="preferences.minEta"
                      (input)="updateAgeRange()"
                    />
                    <span class="range-value">{{ preferences.minEta }}</span>
                  </div>
                </div>
                <div class="sm-col-auto">
                  <label class="form-label small">Et√† Massima</label>
                  <div class="range-container">
                    <input
                      type="range"
                      class="range-slider"
                      min="18"
                      max="65"
                      [(ngModel)]="preferences.maxEta"
                      (input)="updateAgeRange()"
                    />
                    <span class="range-value">{{ preferences.maxEta }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Distanza Massima -->
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Distanza Massima</div>
              <div class="field-value">Raggio di ricerca per i match</div>
            </div>
            <div class="field-actions w-100 d-flex justify-content-center">
              <div class="range-container mt-2">
                <input
                  type="range"
                  class="range-slider"
                  min="5"
                  max="500"
                  [(ngModel)]="preferences.distanzaMax"
                  (input)="updateDistance()"
                />
                <span class="range-value"
                  >{{ preferences.distanzaMax }} km</span
                >
              </div>
            </div>
          </div>

          <!-- üî• PULSANTE SALVA PREFERENZE -->
          <div class="mt-4">
            <button
              class="btn btn-primary btn-lg w-100"
              (click)="savePreferences()"
              [disabled]="saving"
            >
              <i class="fas fa-save"></i>
              {{ saving ? 'Salvando...' : 'Salva Preferenze' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- üî• THEME TAB -->
    <div *ngIf="selectedTab === 'theme'" class="ng-div">
      <!-- Tema Section -->
      <div class="settings-card mb-4">
        <div class="section-header">
          <h3 class="mb-0">Tema</h3>
        </div>
        <div class="p-4">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="field-label">Tema Scuro</div>
              <div class="field-value">
                Attiva il tema scuro per un'esperienza pi√π rilassante
              </div>
            </div>
            <div
              class="toggle-switch"
              [class.active]="isDarkTheme"
              (click)="toggleTheme()"
            >
              <div class="toggle-slider"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üî• NOTIFICATIONS TAB -->
    <div *ngIf="selectedTab === 'notifications'" class="ng-div">
      <!-- Notifiche Section -->
      <div class="settings-card mb-4">
        <div class="section-header">
          <h3 class="mb-0">Notifiche</h3>
        </div>
        <div class="p-4">
          <div class="editable-field">
            <div class="field-info">
              <div class="field-label">Notifiche Attive</div>
              <div class="field-value">
                Ricevi notifiche per match e messaggi
              </div>
            </div>
            <div
              class="toggle-switch"
              [class.active]="userProfile.notificheAttive"
              (click)="toggleNotifications()"
            >
              <div class="toggle-slider"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üî• ACTIONS TAB -->
    <div *ngIf="selectedTab === 'actions'" class="ng-div">
      <!-- Account Actions -->
      <div class="settings-card">
        <div class="section-header">
          <h3 class="mb-0">Azioni Account</h3>
        </div>
        <div class="p-4">
          <div class="d-grid gap-3">
            <button
              class="btn btn-outline-danger btn-lg"
              (click)="deactivateAccount()"
            >
              <i class="fas fa-user-slash"></i> Disattiva Account
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üî• INTERESTS MODAL - AGGIORNATO -->
<div class="modal fade" id="interestsModal" tabindex="-1" #interestsModal>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">üè∑Ô∏è Seleziona i tuoi Interessi</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body interests-modal-body">
        <input
          type="text"
          class="modal-search"
          placeholder="üîç Cerca un interesse..."
          [(ngModel)]="searchTerm"
          (input)="filterInterests()"
        />

        <div class="selected-count">
          Selezionati: {{ selectedInterests.length }} interessi
        </div>

        <!-- Sport & Fitness -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('sport')"
        >
          <div class="category-title">üèÉ‚Äç‚ôÇÔ∏è Sport & Fitness</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.sport"
              class="interest-tag"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Musica & Arte -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('arte')"
        >
          <div class="category-title">üé® Musica & Arte</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.arte"
              class="interest-tag female-style"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Viaggi & Avventura -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('viaggi')"
        >
          <div class="category-title">‚úàÔ∏è Viaggi & Avventura</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.viaggi"
              class="interest-tag"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Cibo & Bevande -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('cibo')"
        >
          <div class="category-title">üçï Cibo & Bevande</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.cibo"
              class="interest-tag female-style"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Tecnologia & Gaming -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('tech')"
        >
          <div class="category-title">üíª Tecnologia & Gaming</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.tech"
              class="interest-tag"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Libri & Cinema -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('cultura')"
        >
          <div class="category-title">üìö Libri & Cinema</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.cultura"
              class="interest-tag female-style"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Animali & Natura -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('natura')"
        >
          <div class="category-title">üêï Animali & Natura</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.natura"
              class="interest-tag"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Lifestyle -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('lifestyle')"
        >
          <div class="category-title">‚ú® Lifestyle</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.lifestyle"
              class="interest-tag female-style"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>

        <!-- Business & Carriera -->
        <div
          class="interest-category"
          [style.display]="getCategoryDisplay('business')"
        >
          <div class="category-title">üíº Business & Carriera</div>
          <div class="interest-grid">
            <span
              *ngFor="let interest of interestCategories.business"
              class="interest-tag"
              [class.selected]="isInterestSelected(interest.key)"
              [style.display]="getInterestDisplay(interest.label)"
              (click)="toggleInterest(interest.key)"
            >
              {{ interest.label }}
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Annulla
        </button>
        <button
          type="button"
          class="btn interests-save-btn"
          (click)="saveInterests()"
          [disabled]="saving"
        >
          <i class="fas fa-save"></i> {{ saving ? 'Salvando...' : 'Salva
          Interessi' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Password Change Modal -->
<div class="modal fade" id="passwordModal" tabindex="-1" #passwordModal>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">üîê Cambia Password</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-4">
            <label class="form-label field-label">Password Attuale</label>
            <input
              type="password"
              class="form-control password-input"
              [(ngModel)]="passwordData.currentPassword"
              name="currentPassword"
              placeholder="Inserisci password attuale"
            />
          </div>
          <div class="mb-4">
            <label class="form-label field-label">Nuova Password</label>
            <input
              type="password"
              class="form-control password-input"
              [(ngModel)]="passwordData.newPassword"
              name="newPassword"
              placeholder="Inserisci nuova password"
            />
          </div>
          <div class="mb-4">
            <label class="form-label field-label"
              >Conferma Nuova Password</label
            >
            <input
              type="password"
              class="form-control password-input"
              [(ngModel)]="passwordData.confirmPassword"
              name="confirmPassword"
              placeholder="Ripeti nuova password"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Annulla
        </button>
        <button
          type="button"
          class="btn password-save-btn"
          (click)="changePassword()"
        >
          Cambia Password
        </button>
      </div>
    </div>
  </div>
</div>

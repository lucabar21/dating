<app-spinner *ngIf="loading" class="spinner"></app-spinner>
<div class="messages-container">
  <!-- Sezione header con chat avviate -->
  <nav class="messages-navbar">
    <div
      *ngFor="let user of chats()"
      [class]="getChatClass(user)"
      (click)="goToChat(user.id)"
    >
      <div class="user-avatar">
        <img
          [src]="user.otherUserProfile?.fotoProfilo || 'http://placedog.net/350'"
          [alt]="getOtherUserDisplayName(user) + '\'s avatar'"
        />
        <!-- üî• BADGE PER UTENTE DISATTIVATO -->
        <div *ngIf="!user.isOtherUserActive" class="deactivated-badge">
          ‚ö†Ô∏è
        </div>
      </div>
      <div class="user-info">
        <h3>{{ getOtherUserDisplayName(user) }}</h3>
      </div>
    </div>
  </nav>

  <!-- Sezione dove sar√† presente la chat -->
  <div class="messages-content">
    <!-- üî• BANNER DI AVVISO SE UTENTE DISATTIVATO -->
    <div *ngIf="isOtherUserDeactivated()" class="deactivated-banner">
      <div class="banner-content">
        <span class="banner-icon">‚ö†Ô∏è</span>
        <div class="banner-text">
          <strong>Questo utente non √® pi√π disponibile</strong>
          <small>Non puoi pi√π inviare messaggi a questo utente</small>
        </div>
      </div>
    </div>

    <router-outlet></router-outlet>
  </div>

  <!-- Form di invio messaggi -->
  <div class="input-chat">
    <form [formGroup]="chatForm">
      <textarea
        formControlName="message"
        placeholder="{{ isOtherUserDeactivated() ? 'Utente non disponibile - non puoi inviare messaggi' : 'Scrivi un messaggio' }}"
        rows="3"
        [disabled]="isOtherUserDeactivated()"
      ></textarea>
      <button
        type="button"
        (click)="sendMessage()"
        [disabled]="isOtherUserDeactivated() || chatForm.invalid"
        [class.disabled]="isOtherUserDeactivated()"
      >
        Invia
      </button>
    </form>
  </div>
</div>
